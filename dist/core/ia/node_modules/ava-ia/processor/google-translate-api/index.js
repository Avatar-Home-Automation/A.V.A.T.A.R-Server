var got = require('got');
//var languages = require('./languages');


function translate(text, opts, gotopts) {
    opts = opts || {};
    gotopts = gotopts || {};
	
	// Commented. Update 5.2.2
	// Not used anymore
    /*var e;
 
    [opts.from, opts.to].forEach(function (lang) {
        if (lang && !languages.isSupported(lang)) {
            e = new Error();
            e.code = 400;
            e.message = 'The language \'' + lang + '\' is not supported';
        }
    });
    if (e) {
        return new Promise(function (resolve, reject) {
            reject(e);
        });
    }*/

    opts.from = opts.from || 'auto';
    opts.to = opts.to || 'en';

    let url = 'https://clients5.google.com/translate_a/t?client=dict-chrome-ex&sl=' + opts.from + '&tl=en&q=' + encodeURIComponent(text)
    return got.post(url)
    .then(res => {
        return JSON.parse(res.body)[0]
    })
    .catch(err => {
        err.message += `\nUrl: ${url}`;
        if (err.statusCode !== undefined && err.statusCode !== 200) {
            err.code = 'BAD_REQUEST';
        } else {
            err.code = 'BAD_NETWORK';
        }
        throw err;
    });
    
}


module.exports = translate;
//module.exports.languages = languages;
