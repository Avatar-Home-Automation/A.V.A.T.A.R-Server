const gotModule = require('got');
const got = gotModule.default ?? gotModule;

async function translate(text, opts, gotopts) {
    opts = opts || {};
    gotopts = gotopts || {};
	
    opts.from = opts.from || 'auto';
    opts.to = opts.to || 'en';

    let url = 'https://clients5.google.com/translate_a/t?client=dict-chrome-ex&sl=' + opts.from + '&tl=en&q=' + encodeURIComponent(text)
   
    try {
        const res = await got(url, { method: 'POST' });
        return JSON.parse(res.body)[0];
    } catch (err) {
        err.message += `\nUrl: ${url}`;
        if (err.statusCode !== undefined && err.statusCode !== 200) {
            err.code = 'BAD_REQUEST';
        } else {
            err.code = 'BAD_NETWORK';
        }
        throw err;
    };
    
}

module.exports = translate;
